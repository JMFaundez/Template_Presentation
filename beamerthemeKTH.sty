\ProvidesPackage{beamerthemeKTH}[2016/06/21]
\mode<presentation>
\RequirePackage{tikz}
\RequirePackage{amssymb}
\RequirePackage{fontawesome}
\usepackage[percent]{overpic}

% Define KTH Colors
\definecolor{kthcolor}{RGB}{25,84,166}
\definecolor{kthcolor_light}{RGB}{36,160,216}
\definecolor{kthcolor_pink}{RGB}{216,84,151}
\definecolor{kthcolor_green}{RGB}{176,201,43}
\definecolor{kthcolor_gray}{RGB}{101,101,108}

% Define Matlab colors
\definecolor{matlabcolor1}{rgb}{0, 0.4470, 0.7410} 
\definecolor{matlabcolor2}{rgb}{0.8500, 0.3250, 0.0980}
\definecolor{matlabcolor3}{rgb}{0.9290, 0.6940, 0.1250}
\definecolor{matlabcolor4}{rgb}{0.4940, 0.1840, 0.5560}

\setbeamertemplate{navigation symbols}{}
\setbeamersize{text margin left=10mm,text margin right=10mm}

\pgfdeclareimage[height=20mm]{kthlogo}{kthgraphics/KTH-logo}
\pgfdeclareimage[height=13mm]{kthlogo_small}{kthgraphics/KTH-logo}
%\pgfdeclareimage[width=\paperwidth, angle=90]{flow_bottom_title}{kthgraphics/bottom_title.pdf}

\newcommand{\kthlines}{%
\begin{tikzpicture}[line width=0.5pt,rounded corners=2pt,color=kthcolor,x=2mm,y=2mm]
  \clip (4,-1) rectangle (81, 12);
  \draw (0,9.5) -- (15,9.5) -- (15,1.7) -- (30,1.7) -- (30,8) -- (44.5,8) -- (44.5,0) -- (55,0) -- (55,9.5)
  -- (63,9.5) -- (63,1) -- (77,1) -- (77,8) -- (82,8) -- (82,6) -- (95,6);
  \draw (0,8) -- (5,8) -- (5,4) -- (20,4) -- (20,9.5) -- (30.5,9.5) -- (30.5,4) -- (48,4) -- (48,7) -- (66,7)
  -- (66,5) -- (73,5) -- (73,10) -- (84.5,10) -- (84.5,3) -- (95,3);
  \draw (0,7) -- (7,7) -- (7,11.5) -- (11,11.5) -- (11,5) -- (18,5) -- (18,8) -- (28.5,8) -- (28.5,5)
  -- (32,5) -- (32,7) -- (36,7) -- (36,5.5) -- (60,5.5) -- (60,11.5) -- (68,11.5) -- (68,7) -- (80,7) -- (80,11) -- (95,11);
  \draw (0,1.7) -- (9,1.7) -- (9,0) -- (33,0) -- (33,1.7) -- (76,1.7) -- (76,0) -- (95,0);
  \draw (0,1) -- (13,1) -- (13,7) -- (25,7) -- (25,1) -- (42,1) -- (42,10) -- (57,10) -- (57,4) -- (61.7,4)
  -- (61.7,8) -- (71,8) -- (71,-0.5) -- (82,-0.5) -- (82,4) -- (95,4);
\end{tikzpicture}}


\newcommand{\kthsingleline}{%
\begin{tikzpicture}[line width=0.5pt,color=kthcolor,x=2mm,y=2mm]
  \draw (0,0) -- (77,0);
\end{tikzpicture}}

%%%% TITLE PAGE BACKGROUND
\newcommand{\startpage}{%
\usebackgroundtemplate{\vbox{\null
 \vspace{3mm}\hspace{3mm}\pgfuseimage{kthlogo}\par
\vspace{-12mm}
  \parbox[c]{\paperwidth}{\centering\includegraphics[width=0.4\textwidth]{kthgraphics/flow_name.png}}\par
  \vspace{38mm}\hbox{\hspace{3mm}\kthlines}%
  \vspace{5mm}\hbox{\hspace{3mm}\kthsingleline}
  %\vspace{46.5mm}\parbox[c]{\paperwidth}{\centering\pgfuseimage{kthlogo}}
  %\vspace{0mm}
  %\includegraphics[width=\paperwidth,angle=180]{kthgraphics/bottom_title.pdf}
}
    }
}

%%% NORMAL PAGE BACKGROUND
\newcommand{\normalpage}{%
\usebackgroundtemplate{\vbox{\null
    \vspace{3mm}
  \hspace{3mm}\pgfuseimage{kthlogo_small}\par
  \vspace{\paperheight}\vspace{-28.5mm}
  \hspace{3mm}\includegraphics[width=0.1\textwidth]{kthgraphics/flow_name.png}\par
  \vspace{1mm}
  \begin{overpic}[width=\paperwidth, angle=180]{kthgraphics/bottom_title.pdf}
  %\vspace{\paperheight}\vspace{-6mm}\hbox{\hspace{3mm}\kthsingleline}
   \vspace{1mm}
   \hbox{
   \begin{tabular}{p{0.3\paperwidth}p{0.3\paperwidth} p{0.3\paperwidth}}
   \small{\textcolor{white}{\inserttitle }} &  
   \centering{\small{\textcolor{white}{\insertinstitute }}} &
   \hfill\small{\textcolor{white}{\insertframenumber/\inserttotalframenumber}}
  
   \end{tabular}
            }
            \end{overpic}
        }
    }
}

%%% White PAGE BACKGROUND
\newcommand{\whitepage}{%
\usebackgroundtemplate{
}
}


%%%%%%%%%%%% SOME FORMAT

\setbeamercolor{title}{fg=kthcolor_gray}
\setbeamerfont{title}{series=\bfseries}

\setbeamercolor{framesubtitle}{fg=kthcolor_light}
\setbeamerfont{framesubtitle}{size=\small}

\setbeamercolor{frametitle}{fg=kthcolor_gray}
\setbeamerfont{frametitle}{series=\bfseries}
\setbeamertemplate{frametitle}{\vspace{4mm}\hspace{15mm}\insertframetitle\par
    \hspace{15mm}\usebeamerfont{framesubtitle}\insertframesubtitle
    
}
\setbeamercolor{alerted text}{fg=kthcolor_pink}
\setbeamercolor{structure}{fg=kthcolor_light}

\setbeamercolor{block title}{bg=kthcolor_light,fg=white}
\setbeamerfont{block title}{series=\bfseries}
\setbeamercolor{block body}{bg=kthcolor_light!40,fg=kthcolor_gray}

\setbeamercolor{block title alerted}{bg=kthcolor_pink,fg=white}
\setbeamerfont{block title alerted}{series=\bfseries}
\setbeamercolor{block body alerted}{bg=kthcolor_pink!40,fg=kthcolor_gray}
  
\setbeamercolor{block title example}{bg=kthcolor_green,fg=white}
\setbeamerfont{block title example}{series=\bfseries}
\setbeamercolor{block body example}{bg=kthcolor_green!40,fg=kthcolor_gray}

%%%%%% ITEM FORMAT
\setbeamertemplate{itemize item}{\color{kthcolor_light}\faCube}
\setbeamertemplate{itemize subitem}{\color{kthcolor_pink}\faChevronRight}

\setbeamertemplate{enumerate item}{\color{kthcolor_light}\Roman{enumi}}
\setbeamertemplate{enumerate subitem}{\color{kthcolor_pink}\roman{enumii}}

%%%% TITLE PAGE  
  \defbeamertemplate*{title page}{customized}[1][]
{\begin{center}
  \usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par
  \usebeamerfont{subtitle}\insertsubtitle\par
  \bigskip
  \usebeamerfont{author}\insertauthor\par
  \usebeamerfont{institute}\insertinstitute\par
  \usebeamerfont{date}\insertdate\par
 \end{center}
}


%%%%%%%%%%%%%%% Table of contents

\setbeamertemplate{section in toc}[square]
\setbeamerfont{section number projected}{size=\large}
\setbeamercolor{section number projected}{bg=kthcolor,fg=white}
\setbeamercolor{section in toc}{fg=black}
\setbeamerfont{section in toc}{size=\large}


%%%%%%%%%%%% Setting path to Figures
\graphicspath{{figures/}}


%%%%%%%%%%% Footnote position
\setbeamercolor{footnote}{fg=kthcolor_gray}
\renewcommand\footnoterule{\rule{\linewidth}{0pt}}
\setbeamertemplate{footnote}{
        \parindent 0em\noindent%
        \raggedleft
        %\raggedright
            \usebeamercolor{footnote}\hbox to 0.8em{\hfil\insertfootnotemark}\insertfootnotetext\par%
        \vspace{0.6cm}
        }



% move title to center
% \makeatletter
% \setbeamertemplate{frametitle}{
%     \ifbeamercolorempty[bg]{frametitle}{}{\nointerlineskip}%
%     \@tempdima=\textwidth%
%     \advance\@tempdima by\beamer@leftmargin%
%     \advance\@tempdima by\beamer@rightmargin%
%     \advance\@tempdima by -23mm%
%     \vskip -1mm%
%     \begin{beamercolorbox}[sep=0.3cm,left,wd=\the\@tempdima]{frametitle}
%         \usebeamerfont{frametitle}%
%         \vbox{}\vskip+1ex%
%         \if@tempswa\else\csname beamer@ftecenter\endcsname\fi%
%         \strut\insertframetitle\strut\par%
%         {%
%             \ifx\insertframesubtitle\@empty%
%             \else%
%             {\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\insertframesubtitle\strut\par}%
%             \fi
%         }%
%         \vskip-1ex%
%         \if@tempswa\else\vskip-.3cm\fi% set inside beamercolorbox... evil here...
%     \end{beamercolorbox}%
% }
% \makeatother
